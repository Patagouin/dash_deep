Concatene dans une colonne (pour mieux voir les pourcentage), les diff√©rents pourcentages
CREATE OR REPLACE FUNCTION get_columns_percent()
RETURNS TABLE (
    idShare SMALLINT,
    date DATE,
    percent_columns JSONB
) AS $$
DECLARE 
    columns_list TEXT;
BEGIN
    SELECT STRING_AGG('"' || column_name || '"', ', ') 
    INTO columns_list
    FROM information_schema.columns 
    WHERE table_schema = 'public'
    AND table_name = 'sharesPotentials' 
    AND column_name LIKE '%_percent';

    RETURN QUERY EXECUTE format('
        SELECT "idShare", date, jsonb_strip_nulls(jsonb_build_object(%s)) as percent_columns
        FROM public."sharesPotentials" 
        ORDER BY date ASC, "idShare" ASC
    ', columns_list);
END;
$$ LANGUAGE plpgsql;

SELECT * FROM get_columns_percent();